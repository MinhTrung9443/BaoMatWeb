!function(e){function t(){var e={};return function(I){(function(a,o){"use strict";var u={};function r(e,t){var i,r=[];for(var n=0;n<e.length;++n){i=u[e[n]]||s(e[n]);if(!i)throw"module definition dependecy not found: "+e[n];r.push(i)}t.apply(null,r)}function e(e,t,i){if(typeof e!=="string")throw"invalid module definition, module id must be defined and be a string";if(t===o)throw"invalid module definition, dependencies must be specified";if(i===o)throw"invalid module definition, definition function must be specified";r(t,function(){u[e]=i.apply(null,arguments)})}function t(e){return!!u[e]}function s(e){var t=a;var i=e.split(/[.\/]/);for(var r=0;r<i.length;++r){if(!t[i[r]])return;t=t[i[r]]}return t}function i(e){for(var t=0;t<e.length;t++){var i=a;var r=e[t];var n=r.split(/[.\/]/);for(var s=0;s<n.length-1;++s){if(i[n[s]]===o)i[n[s]]={};i=i[n[s]]}i[n[n.length-1]]=u[r]}}e("plupload",[],function(){var e=I;var s=e.core.utils;s.Env.global_event_dispatcher="plupload.EventTarget.instance.dispatchEvent";return{VERSION:"3.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,OPTION_ERROR:-800,moxie:e,ua:s.Env,typeOf:s.Basic.typeOf,clone:s.Basic.clone,inherit:s.Basic.inherit,extend:s.Basic.extend,extendImmutable:s.Basic.extendImmutable,extendIf:s.Basic.extendIf,inSeries:s.Basic.inSeries,inParallel:s.Basic.inParallel,guid:s.Basic.guid,getAll:function e(t){var i=[],r;if(s.Basic.typeOf(t)!=="array")t=[t];var n=t.length;while(n--){r=s.Dom.get(t[n]);if(r)i.push(r)}return i.length?i:null},get:s.Dom.get,each:s.Basic.each,getPos:s.Dom.getPos,getSize:s.Dom.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return e?(""+e).replace(i,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:s.Basic.toArray,inArray:s.Basic.inArray,addI18n:e.core.I18n.addI18n,translate:e.core.I18n.translate,sprintf:s.Basic.sprintf,isEmptyObj:s.Basic.isEmptyObj,hasClass:s.Dom.hasClass,addClass:s.Dom.addClass,removeClass:s.Dom.removeClass,getStyle:s.Dom.getStyle,addEvent:s.Events.addEvent,removeEvent:s.Events.removeEvent,removeAllEvents:s.Events.removeAllEvents,cleanName:function(e){var t,i;i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);e=e.replace(/\s+/g,"_");e=e.replace(/[^a-z0-9_\-\.]+/gi,"");return e},buildUrl:function(e,t){var i="";s.Basic.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(i)e+=(e.indexOf("?")>0?"&":"?")+i;return e},formatSize:function(e){var t=this;function i(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}e=parseInt(e,10);if(isNaN(e))return t.translate("N/A");var r=Math.pow(1024,4);if(e>r)return i(e/r,1)+" "+t.translate("tb");if(e>(r/=1024))return i(e/r,1)+" "+t.translate("gb");if(e>(r/=1024))return i(e/r,1)+" "+t.translate("mb");if(e>1024)return Math.round(e/1024)+" "+t.translate("kb");return e+" "+t.translate("b")},mimes2extList:I.core.utils.Mime.mimes2extList,resolveUrl:s.Url.resolveUrl,parseSize:s.Basic.parseSizeStr,delay:s.Basic.delay,EventTarget:I.core.EventTarget,Runtime:I.runtime.Runtime,FileInput:I.file.FileInput,FileReader:I.file.FileReader}});e("plupload/core/Collection",["plupload"],function(e){var a=function(){var r={};var n=0;var s;plupload.extend(this,{count:function(){return n},hasKey:function(e){return r.hasOwnProperty(e)},get:function(e){return r[e]},first:function(){for(var e in r)return r[e]},last:function(){return s},toObject:function(){return r},add:function(e,t){var i=this;if(typeof e==="object"&&!t)return plupload.each(e,function(e,t){i.add(t,e)});if(r.hasOwnProperty(e))return i.update.apply(i,arguments);r[e]=s=t;n++},remove:function(e){if(this.hasKey(e)){var t=r[e];delete r[e];n--;if(s===t)s=i()}},extract:function(e){var t=this.get(e);this.remove(e);return t},shift:function(){var e=this,t,i;for(i in r){t=r[i];e.remove(i);return t}},update:function(e,t){r[e]=t},each:function(e){plupload.each(r,e)},combineWith:function(){var t=new a;t.add(r);plupload.each(arguments,function(e){if(e instanceof a)t.add(e.toObject())});return t},clear:function(){r={};s=null;n=0}});function i(){var e;for(e in r);return r[e]}};return a});e("plupload/core/ArrCollection",["plupload"],function(i){var e=function(){var r=[];i.extend(this,{count:function(){return r.length},hasKey:function(e){return this.getIdx(e)>-1},get:function(e){var t=this.getIdx(e);return t>-1?r[t]:null},getIdx:function(e){for(var t=0,i=r.length;t<i;t++)if(r[t].uid===e)return t;return-1},getByIdx:function(e){return r[e]},first:function(){return r[0]},last:function(){return r[r.length-1]},add:function(e){e=arguments[1]||e;var t=this.getIdx(e.uid);if(t>-1){r[t]=e;return t}r.push(e);return r.length-1},remove:function(e){return!!this.extract(e)},splice:function(e,t){e=i.typeOf(e)==="undefinded"?0:Math.max(e,0);t=i.typeOf(t)!=="undefinded"&&e+t<r.length?t:r.length-e;return r.splice(e,t)},extract:function(e){var t=this.getIdx(e);if(t>-1)return r.splice(t,1);return null},shift:function(){return r.shift()},update:function(e,t){var i=this.getIdx(e);if(i>-1){r[i]=t;return true}return false},each:function(e){i.each(r,e)},combineWith:function(){return Array.prototype.concat.apply(this.toArray(),arguments)},sort:function(e){r.sort(e||function(e,t){return e.priority-t.priority})},clear:function(){r=[]},toObject:function(){var e={};for(var t=0,i=r.length;t<i;t++)e[r[t].uid]=r[t];return e},toArray:function(){return Array.prototype.slice.call(r)}})};return e});e("plupload/core/Optionable",["plupload"],function(s){var e=I.core.EventTarget;var t=["OptionChanged"];return function(e){function t(){e.apply(this,arguments);this._options={}}s.inherit(t,e);s.extend(t.prototype,{setOption:function(e,t,i){var r=this;var n;if(typeof e==="object"){i=t;s.each(e,function(e,t){r.setOption(t,e,i)});return}if(i&&!r._options.hasOwnProperty(e))return;n=s.clone(r._options[e]);if(s.typeOf(t)==="object"&&s.typeOf(r._options[e])==="object")s.extend(r._options[e],t);else r._options[e]=t;r.trigger("OptionChanged",e,t,n)},getOption:function(e){if(!e)return this._options;var t=this._options[e];if(s.inArray(s.typeOf(t),["array","object"])>-1)return s.extendImmutable({},t);else return t},setOptions:function(e,t){if(typeof e!=="object")return;this.setOption(e,t)},getOptions:function(){return this.getOption()}});return t}(e)});e("plupload/core/Queueable",["plupload","plupload/core/Optionable"],function(o,e){var t=["statechanged","queued","started","paused","resumed","stopped","progress","failed","done","processed","destroy"];return function(e){function a(){e.apply(this,arguments);this.uid=o.guid();this.state=a.IDLE;this.processed=0;this.total=0;this.percent=0;this.retries=0;this.priority=0;this.startedTimestamp=0;this.processedTimestamp=0;if(MXI_DEBUG)this.bind("StateChanged",function(e,t,i){var r=this;var n=function(e){switch(e){case a.IDLE:return"IDLE";case a.PROCESSING:return"PROCESSING";case a.PAUSED:return"PAUSED";case a.RESUMED:return"RESUMED";case a.DONE:return"DONE";case a.FAILED:return"FAILED";case a.DESTROYED:return"DESTROYED"}};var s=function(){switch(r.ctorName){case"File":return"\t".repeat(2);case"QueueUpload":case"QueueResize":return"\t";case"FileUploader":return"\t".repeat(3);case"ChunkUploader":return"\t".repeat(4);default:return"\t"}};o.ua.log("StateChanged:"+s()+r.ctorName+"::"+r.uid+" ("+n(i)+" to "+n(t)+")")},999)}a.IDLE=1;a.PROCESSING=2;a.PAUSED=6;a.RESUMED=7;a.DONE=5;a.FAILED=4;a.DESTROYED=8;o.inherit(a,e);o.extend(a.prototype,{start:function(){var e=this.state;if(this.state===a.PROCESSING)return false;if(!this.startedTimestamp)this.startedTimestamp=+new Date;this.state=a.PROCESSING;this.trigger("statechanged",this.state,e);this.trigger("started");return true},pause:function(){var e=this.state;if(o.inArray(this.state,[a.IDLE,a.RESUMED,a.PROCESSING])===-1)return false;this.processed=this.percent=0;this.loaded=this.processed;this.state=a.PAUSED;this.trigger("statechanged",this.state,e);this.trigger("paused");return true},resume:function(){var e=this.state;if(this.state!==a.PAUSED&&this.state!==a.RESUMED)return false;this.state=a.RESUMED;this.trigger("statechanged",this.state,e);this.trigger("resumed");return true},stop:function(){var e=this.state;if(this.state===a.IDLE)return false;this.processed=this.percent=0;this.loaded=this.processed;this.startedTimestamp=0;this.state=a.IDLE;this.trigger("statechanged",this.state,e);this.trigger("stopped");return true},done:function(e){var t=this.state;if(this.state===a.DONE)return false;this.processed=this.total;this.loaded=this.processed;this.percent=100;this.processedTimestamp=+new Date;this.state=a.DONE;this.trigger("statechanged",this.state,t);this.trigger("done",e);this.trigger("processed");return true},failed:function(e){var t=this.state;if(this.state===a.FAILED)return false;this.processed=this.percent=0;this.loaded=this.processed;this.processedTimestamp=+new Date;this.state=a.FAILED;this.trigger("statechanged",this.state,t);this.trigger("failed",e);this.trigger("processed");return true},progress:function(e,t){if(t)this.total=t;this.processed=Math.min(e,this.total);this.loaded=this.processed;this.percent=Math.ceil(this.processed/this.total*100);this.trigger({type:"progress",loaded:this.processed,total:this.total})},destroy:function(){var e=this.state;if(this.state===a.DESTROYED)return false;this.state=a.DESTROYED;this.trigger("statechanged",this.state,e);this.trigger("destroy");this.unbindAll();return true}});return a}(e)});e("plupload/core/Stats",[],function(){return function(){var e=this;e.size=0;e.total=0;e.loaded=0;e.uploaded=0;e.done=0;e.failed=0;e.queued=0;e.paused=0;e.processing=0;e.paused=0;e.percent=0;e.bytesPerSec=0;e.processedPerSec=0;e.reset=function(){e.size=e.total=e.loaded=e.processed=e.uploaded=e.done=e.failed=e.queued=e.processing=e.paused=e.percent=e.bytesPerSec=e.processedPerSec=0}}});e("plupload/core/Queue",["plupload","plupload/core/ArrCollection","plupload/core/Queueable","plupload/core/Stats"],function(s,a,o,u){var e=["Started","Progress","Paused","Done","Stopped","Destroy"];return function(t){s.inherit(i,t);function i(e){t.apply(this,arguments);this._queue=new a;this.stats=new u;this._options=s.extend({},this._options,{max_slots:1,max_retries:0,auto_start:false,finish_active:false},e)}s.extend(i.prototype,{count:function(){return this._queue.count()},start:function(){if(!i.parent.start.call(this))return false;return n.call(this)},pause:function(){if(!i.parent.pause.call(this))return false;this.forEachItem(function(e){e.pause()})},stop:function(){if(!i.parent.stop.call(this)||this.getOption("finish_active"))return false;if(this.isActive())this.forEachItem(function(e){e.stop()})},forEachItem:function(e){this._queue.each(e)},getItem:function(e){return this._queue.get(e)},addItem:function(e){var t=this;e.bind("Started",function(){if(t.calcStats())s.delay.call(t,n)});e.bind("Resumed",function(){t.start()});e.bind("Paused",function(){if(t.calcStats())s.delay.call(t,function(){if(!n.call(t)&&!t.stats.processing)t.pause()})});e.bind("Processed Stopped",function(){if(t.calcStats())s.delay.call(t,function(){if(!n.call(t)&&!this.isStopped()&&!this.isActive())t.stop()})});e.bind("Progress",function(){if(t.calcStats())t.trigger("Progress",t.stats.processed,t.stats.total,t.stats)});e.bind("Failed",function(){if(t.getOption("max_retries")&&this.retries<t.getOption("max_retries")){this.stop();this.retries++}});this._queue.add(e.uid,e);this.calcStats();e.trigger("Queued");if(t.getOption("auto_start")||t.state===o.PAUSED)s.delay.call(this,this.start)},extractItem:function(e){var t=this._queue.get(e);if(t){this.stopItem(t.uid);this._queue.remove(e);this.calcStats()}return t},removeItem:function(e){var t=this.extractItem(e);if(t){t.destroy();return true}return false},stopItem:function(e){var t=this._queue.get(e);if(t)return t.stop();else return false},pauseItem:function(e){var t=this._queue.get(e);if(t)return t.pause();else return false},resumeItem:function(e){var t=this._queue.get(e);if(t){s.delay.call(this,function(){this.start()});return t.resume()}else return false},splice:function(e,t){return this._queue.splice(e,t)},isActive:function(){return this.stats&&(this.stats.processing||this.stats.paused)},isStopped:function(){return this.state===o.IDLE||this.state===o.DESTROYED},countSpareSlots:function(){return Math.max(this.getOption("max_slots")-this.stats.processing,0)},toArray:function(){return this._queue.toArray()},clear:function(){var e=this;if(e.state!==o.IDLE){e.bindOnce("Stopped",function(){e.clear()});return e.stop()}else{e._queue.clear();e.stats.reset()}},calcStats:function(){var t=this;var i=t.stats;var r=0;var n=0;if(!i)return false;i.reset();t.forEachItem(function(e){switch(e.state){case o.DONE:i.done++;i.uploaded=i.done;break;case o.FAILED:i.failed++;break;case o.PROCESSING:i.processing++;break;case o.PAUSED:i.paused++;break;default:i.queued++}r+=e.processed;if(!e.processedTimestamp||e.processedTimestamp>t.startedTimestamp)n+=r;i.processedPerSec=Math.ceil(n/((+new Date-t.startedTimestamp||1)/1e3));i.processed=r;i.total+=e.total;if(i.total)i.percent=Math.ceil(i.processed/i.total*100)});t.percent=i.percent;i.loaded=i.processed;i.size=i.total;i.bytesPerSec=i.processedPerSec;return true},destroy:function(){var e=this;if(e.state===o.DESTROYED)return false;if(e.state!==o.IDLE){e.bindOnce("Stopped",function(){s.delay.call(e,e.destroy)});return e.stop()}else{e.clear();i.parent.destroy.call(this);e._queue=e.stats=null}return true}});function r(){var t;this.forEachItem(function(e){if(e.state===o.IDLE||e.state===o.RESUMED){t=e;return false}});return t?t:null}function n(){var e;if(this.state!==o.PROCESSING&&this.state!==o.PAUSED)return false;if(this.stats.processing<this.getOption("max_slots")){e=r.call(this);if(e)if(e.trigger("beforestart")){e.setOptions(this.getOptions());return e.start()}else{e.pause();n.call(this)}}return false}return i}(o)});e("plupload/QueueUpload",["plupload","plupload/core/Queue"],function(t,r){return function(e){t.inherit(i,e);function i(e){r.call(this,{max_slots:1,max_retries:0,auto_start:false,finish_active:false,url:false,chunk_size:0,multipart:true,http_method:"POST",params:{},headers:false,file_data_name:"file",send_file_name:true,stop_on_fail:true});this.setOption=function(e,t){if(typeof e!=="object")if(e=="max_upload_slots")e="max_slots";i.prototype.setOption.call(this,e,t,true)};this.setOptions(e)}return i}(r)});e("plupload/QueueResize",["plupload","plupload/core/Queue"],function(t,r){return function(e){t.inherit(i,e);function i(e){r.call(this,{max_slots:1,max_retries:0,auto_start:false,finish_active:false,resize:{}});this.setOption=function(e,t){if(typeof e!=="object")if(e=="max_resize_slots")e="max_slots";i.prototype.setOption.call(this,e,t,true)};this.setOptions(e)}return i}(r)});e("plupload/ChunkUploader",["plupload","plupload/core/Collection","plupload/core/Queueable"],function(u,e,l){var p=I.xhr.XMLHttpRequest;var c=I.xhr.FormData;function i(s){var a;l.call(this);this._options={file_data_name:"file",headers:false,http_method:"POST",multipart:true,params:{},send_file_name:true,url:false};u.extend(this,{start:function(){var t=this;var e;var i;var r=this.state;var n=t._options;if(this.state===l.PROCESSING)return false;if(!this.startedTimestamp)this.startedTimestamp=+new Date;this.state=l.PROCESSING;this.trigger("statechanged",this.state,r);a=new p;if(a.upload)a.upload.onprogress=function(e){t.progress(e.loaded,e.total)};a.onload=function(){var e={response:this.responseText,status:this.status,responseHeaders:this.getAllResponseHeaders()};if(this.status<200||this.status>=400)return t.failed(e);t.done(e)};a.onerror=function(){t.failed()};a.onloadend=function(){setTimeout(function(){if(a){a.destroy();a=null}},1)};try{e=n.multipart?n.url:o(n.url,n.params);a.open(n.http_method,e,true);if(!u.isEmptyObj(n.headers))u.each(n.headers,function(e,t){a.setRequestHeader(t,e)});if(n.multipart){i=new c;if(!u.isEmptyObj(n.params))u.each(n.params,function(e,t){i.append(t,e)});i.append(n.file_data_name,s);a.send(i)}else{if(u.isEmptyObj(n.headers)||!a.hasRequestHeader("content-type"))a.setRequestHeader("content-type","application/octet-stream");a.send(s)}this.trigger("started")}catch(e){t.failed()}},stop:function(){if(a){a.abort();a.destroy();a=null}i.prototype.stop.call(this)},setOption:function(e,t){i.prototype.setOption.call(this,e,t,true)},setOptions:function(e){i.prototype.setOption.call(this,e,true)},destroy:function(){this.stop();i.prototype.destroy.call(this)}});function o(e,t){var i="";u.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(i)e+=(e.indexOf("?")>0?"&":"?")+i;return e}}u.inherit(i,l);return i});e("plupload/FileUploader",["plupload","plupload/core/Collection","plupload/core/Queueable","plupload/ChunkUploader"],function(d,e,h,g){function t(o,u){var l=new e;var p=1;h.call(this);this._options={chunk_size:0,params:{},send_file_name:true,stop_on_fail:true};d.extend(this,{name:o.name,start:function(){var i=this;var e=this.state;var t;if(this.state===h.PROCESSING)return false;if(!this.startedTimestamp)this.startedTimestamp=+new Date;this.state=h.PROCESSING;this.trigger("statechanged",this.state,e);if(i._options.send_file_name)i._options.params.name=i.target_name||i.name;if(i._options.chunk_size){p=Math.ceil(o.size/i._options.chunk_size);i.uploadChunk(false,true)}else{t=new g(o);t.bind("progress",function(e){i.progress(e.loaded,e.total)});t.bind("done",function(e,t){i.done(t)});t.bind("failed",function(e,t){i.failed(t)});t.setOptions(i._options);u.addItem(t)}this.trigger("started")},uploadChunk:function(e,i){var r=this;var t=this.getOption("chunk_size");var n;var s={};var a;s.seq=parseInt(e,10)||f();s.start=s.seq*t;s.end=Math.min(s.start+t,o.size);s.total=o.size;if(s.start<0||s.start>=o.size)return false;a=d.extendImmutable({},this.getOptions(),{params:{chunk:s.seq,chunks:p}});n=new g(o.slice(s.start,s.end,o.type));n.bind("progress",function(e){r.progress(c()+e.loaded,o.size)});n.bind("failed",function(e,t){l.add(s.seq,d.extend({state:h.FAILED},s));r.trigger("chunkuploadfailed",d.extendImmutable({},s,t));if(a.stop_on_fail)r.failed(t)});n.bind("done",function(e,t){l.add(s.seq,d.extend({state:h.DONE},s));r.trigger("chunkuploaded",d.extendImmutable({},s,t));if(c()>=o.size){r.progress(o.size,o.size);r.done(t)}else if(i)d.delay(function(){r.uploadChunk(f(),i)})});n.bind("processed",function(){this.destroy()});n.setOptions(a);l.add(s.seq,d.extend({state:h.PROCESSING},s));u.addItem(n);if(i&&u.countSpareSlots())r.uploadChunk(f(),i);return true},destroy:function(){t.prototype.destroy.call(this);l.clear()}});function c(){var t=0;l.each(function(e){if(e.state===h.DONE)t+=e.end-e.start});return t}function f(){var e=0;while(e<p&&l.hasKey(e))e++;return e}}d.inherit(t,h);return t});e("plupload/ImageResizer",["plupload","plupload/core/Queueable"],function(e,t){var n=I.image.Image;function i(r){t.call(this);this._options={type:"image/jpeg",quality:90,crop:false,fit:true,preserveHeaders:true,resample:"default",multipass:true};this.setOption=function(e,t){if(typeof e!=="object"&&!this._options.hasOwnProperty(e))return;i.prototype.setOption.apply(this,arguments)};this.start=function(e){var t=this;var i;if(e)this.setOptions(e.resize);i=new n;i.bind("load",function(){this.resize(t.getOptions())});i.bind("resize",function(){t.done(this.getAsBlob(t.getOption("type"),t.getOption("quality")));this.destroy()});i.bind("error",function(){t.failed();this.destroy()});i.load(r,t.getOption("runtimeOptions"))}}e.inherit(i,t);e.Image=n;return i});e("plupload/File",["plupload","plupload/core/Queueable","plupload/FileUploader","plupload/ImageResizer"],function(s,i,a,o){function e(r,t,n){i.call(this);s.extend(this,{id:this.uid,name:r.name,target_name:null,type:r.type,size:r.size,origSize:r.size,start:function(){var e=this.state;if(this.state===i.PROCESSING)return false;this.state=i.PROCESSING;this.trigger("statechanged",this.state,e);this.trigger("started");if(!s.isEmptyObj(this._options.resize)&&u(this.type)&&l(r,"send_binary_string"))this.resizeAndUpload();else this.upload();return true},getSource:function(){return r},getNative:function(){return this.getFile().getSource()},resizeAndUpload:function(){var i=this;var e=i.getOptions();var t=new o(r);t.bind("progress",function(e){i.progress(e.loaded,e.total)});t.bind("done",function(e,t){t=t;i.upload()});t.bind("failed",function(){i.upload()});t.setOption("runtimeOptions",{runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:e.preferred_caps,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url});n.addItem(t)},upload:function(){var i=this;var e=new a(r,t);e.bind("paused",function(){i.pause()});e.bind("resumed",function(){this.start()});e.bind("started",function(){i.trigger("startupload")});e.bind("progress",function(e){i.progress(e.loaded,e.total)});e.bind("done",function(e,t){i.done(t)});e.bind("failed",function(e,t){i.failed(t)});e.setOptions(i.getOptions());e.start()},destroy:function(){e.prototype.destroy.call(this);r=null}})}function u(e){return s.inArray(e,["image/jpeg","image/png"])>-1}function l(e,t){if(e.ruid){var i=s.Runtime.getInfo(e.ruid);if(i)return i.can(t)}return false}s.inherit(e,i);return e});e("plupload/Uploader",["plupload","plupload/core/Collection","plupload/core/Queue","plupload/QueueUpload","plupload/QueueResize","plupload/File"],function(h,e,g,m,_,v){var O={};var y;function E(e){var a=[];var o=[];var p,c;var s=false;var u=false;var t=b(h.extend({backward_compatibility:true,chunk_size:0,file_data_name:"file",filters:{mime_types:"*",prevent_duplicates:false,max_file_size:0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_resize_slots:1,max_retries:0,max_upload_slots:1,multipart:true,multipart_params:{},multi_selection:true,params:{},resize:false,runtimes:h.Runtime.order,send_chunk_number:true,send_file_name:true,silverlight_xap_url:"js/Moxie.xap",required_features:false,preferred_caps:false},e));g.call(this);h.extend(this,{_options:t,id:this.uid,state:h.STOPPED,features:{},settings:t,runtime:null,files:[],total:this.stats,init:function(){var n=this,e,t;e=n.getOption("preinit");if(typeof e=="function")e(n);else h.each(e,function(e,t){n.bind(t,e)});i.call(n);h.each(["container","browse_button","drop_element"],function(e){if(n.getOption(e)===null){t={code:h.INIT_ERROR,message:h.sprintf(h.translate("%s specified, but cannot be found."),e)};return false}});if(t)return n.trigger("Error",t);if(!n.getOption("browse_button")&&!n.getOption("drop_element"))return n.trigger("Error",{code:h.INIT_ERROR,message:h.translate("You must specify either browse_button or drop_element.")});r.call(n,function(e){var t;var i=n.getOption("init");var r=h.extendImmutable({},n.getOption(),{auto_start:true});if(typeof i=="function")i(n);else h.each(i,function(e,t){n.bind(t,e)});if(e){s=true;t=h.Runtime.getInfo(f());p=new m(r);c=new _(r);n.trigger("Init",{ruid:t.uid,runtime:n.runtime=t.type});n.trigger("PostInit")}else n.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})})},setOption:function(e,t){if(s)if(h.inArray(e,["container","browse_button","drop_element","runtimes","multi_selection","flash_swf_url","silverlight_xap_url"])>-1)return this.trigger("Error",{code:h.OPTION_ERROR,message:h.sprintf(h.translate("%s option cannot be changed.")),option:e});if(typeof e!=="object"){t=R(e,t,this._options);if(p)p.setOption(e,t);if(c)c.setOption(e,t)}E.prototype.setOption.call(this,e,t)},refresh:function(){if(a.length)h.each(a,function(e){e.trigger("Refresh")});if(o.length)h.each(o,function(e){e.trigger("Refresh")});this.trigger("Refresh")},stop:function(){if(E.prototype.stop.call(this)&&this.state!=h.STOPPED)this.trigger("CancelUpload")},disableBrowse:function(){u=arguments[0]!==y?arguments[0]:true;if(a.length)h.each(a,function(e){e.disable(u)});this.trigger("DisableBrowse",u)},getFile:function(e){return this.getItem(e)},addFile:function(e,n){var s=this;var t=[];var i;var a=[];function o(e){e.bind("beforestart",function(e){return s.trigger("BeforeUpload",e.target)});e.bind("startupload",function(){s.trigger("UploadFile",this)});e.bind("progress",function(){s.trigger("UploadProgress",this)});e.bind("done",function(e,t){s.trigger("FileUploaded",this,t)});e.bind("failed",function(e,t){s.trigger("Error",h.extend({code:h.HTTP_ERROR,message:h.translate("HTTP Error."),file:this},t))})}function u(r,e){var t=[];h.each(s.getOption("filters"),function(e,i){if(O[i])t.push(function(t){O[i].call(s,e,r,function(e){t(!e)})})});h.inParallel(t,e)}function l(r){var e=h.typeOf(r);if(r instanceof I.file.File){if(!r.ruid&&!r.isDetached()){if(!i)return false;r.ruid=i;r.connectRuntime(i)}t.push(function(i){u(r,function(e){var t;if(!e){t=new v(r,p,c);if(n)t.name=n;o(t);s.addItem(t);a.push(t);s.trigger("FileFiltered",t)}h.delay(i)})})}else if(r instanceof I.file.Blob){l(r.getSource());r.destroy()}else if(h.inArray(e,["file","blob"])!==-1)l(new I.file.File(null,r));else if(e==="node"&&h.typeOf(r.files)==="filelist")h.each(r.files,l);else if(e==="array"){n=null;h.each(r,l)}}i=f();l(e);if(t.length)h.inParallel(t,function(){if(a.length)s.trigger("FilesAdded",a)})},removeFile:function(e){var t=this.extractItem(typeof e==="string"?e:e.uid);if(t){this.trigger("FilesRemoved",[t]);t.destroy()}},splice:function(){var e=0;var t=h.STARTED==this.state;var i=g.prototype.splice.apply(this,arguments);if(i.length){this.trigger("FilesRemoved",i);if(t)this.stop();for(e=0;e<i.length;e++)i[e].destroy();if(t)this.start()}},dispatchEvent:function(e){var t,i,r;e=e.toLowerCase();t=this.hasEventListener(e);if(t){t.sort(function(e,t){return t.priority-e.priority});i=[].slice.call(arguments);i.shift();i.unshift(this);for(var n=0;n<t.length;n++)if(t[n].fn.apply(t[n].scope,i)===false)return false}return true},bind:function(e,t,i,r){h.Uploader.prototype.bind.call(this,e,t,r,i)}});if(t.backward_compatibility){this.bind("FilesAdded FilesRemoved",function(e){e.files=e.toArray()},this,999);this.bind("OptionChanged",function(e,t,i){e.settings[t]=typeof i=="object"?h.extend({},i):i},this,999)}function f(){var e=a[0]||o[0];if(e)return e.getRuntime().uid;return false}function i(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged");e.refresh()},this,999);this.bind("BeforeUpload",n);this.bind("Stopped",function(e){e.trigger("UploadComplete")});this.bind("Error",l);this.bind("Destroy",d)}function r(e){var r=this;var n=0;var t=[];var s={runtime_order:r.getOption("runtimes"),required_caps:r.getOption("required_features"),preferred_caps:r.getOption("preferred_caps"),swf_url:r.getOption("flash_swf_url"),xap_url:r.getOption("silverlight_xap_url")};h.each(r.getOption("runtimes").split(/\s*,\s*/),function(e){if(r.getOption(e))s[e]=r.getOption(e)});if(r.getOption("browse_button"))h.each(r.getOption("browse_button"),function(i){t.push(function(t){var e=new I.file.FileInput(h.extend({},s,{accept:r.getOption("filters").mime_types,name:r.getOption("file_data_name"),multiple:r.getOption("multi_selection"),container:r.getOption("container"),browse_button:i}));e.onready=function(){var e=h.Runtime.getInfo(this.ruid);h.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")});n++;a.push(this);t()};e.onchange=function(){r.addFile(this.files)};e.bind("mouseenter mouseleave mousedown mouseup",function(e){if(!u){if(r.getOption("browse_button_hover"))if("mouseenter"===e.type)h.addClass(i,r.getOption("browse_button_hover"));else if("mouseleave"===e.type)h.removeClass(i,r.getOption("browse_button_hover"));if(r.getOption("browse_button_active"))if("mousedown"===e.type)h.addClass(i,r.getOption("browse_button_active"));else if("mouseup"===e.type)h.removeClass(i,r.getOption("browse_button_active"))}});e.bind("mousedown",function(){r.trigger("Browse")});e.bind("error runtimeerror",function(){e=null;t()});e.init()})});if(r.getOption("drop_element"))h.each(r.getOption("drop_element"),function(i){t.push(function(t){var e=new I.file.FileDrop(h.extend({},s,{drop_zone:i}));e.onready=function(){var e=h.Runtime.getInfo(this.ruid);h.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")});n++;o.push(this);t()};e.ondrop=function(){r.addFile(this.files)};e.bind("error runtimeerror",function(){e=null;t()});e.init()})});h.inParallel(t,function(){if(typeof e==="function")e(n)})}function n(e,t){if(e.getOption("unique_names")){var i=t.name.match(/\.([^.]+)$/),r="part";if(i)r=i[1];t.target_name=t.id+"."+r}}function l(e,t){if(t.code===h.INIT_ERROR)e.destroy();else if(t.code===h.HTTP_ERROR&&e.state==h.STARTED)e.trigger("CancelUpload")}function d(e){e.forEachItem(function(e){e.destroy()});if(a.length){h.each(a,function(e){e.destroy()});a=[]}if(o.length){h.each(o,function(e){e.destroy()});o=[]}s=false;if(p)p.destroy();if(c)c.destroy();t=p=c=null}}function n(e){var t=e.required_features,n={};function i(e,t,i){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};if(r[e])n[r[e]]=t;else if(!i)n[e]=t}if(typeof t==="string")h.each(t.split(/\s*,\s*/),function(e){i(e,true)});else if(typeof t==="object")h.each(t,function(e,t){i(t,e)});else if(t===true){if(e.chunk_size&&e.chunk_size>0)n.slice_blob=true;if(!h.isEmptyObj(e.resize)||e.multipart===false)n.send_binary_string=true;if(e.http_method)n.use_http_method=e.http_method;h.each(e,function(e,t){i(t,!!e,true)})}return n}function b(i){h.each(i,function(e,t){i[t]=R(t,e,i)});return i}function R(e,t,i){switch(e){case"chunk_size":if(t=h.parseSize(t))i.send_file_name=true;break;case"headers":var r={};if(typeof t==="object")h.each(t,function(e,t){r[t.toLowerCase()]=e});return r;case"http_method":return t.toUpperCase()==="PUT"?"PUT":"POST";case"filters":if(h.typeOf(t)==="array")t={mime_types:t};if(t.mime_types){if(h.typeOf(t.mime_types)==="string")t.mime_types=h.mimes2extList(t.mime_types);i.re_ext_filter=function(e){var t=[];h.each(e,function(e){h.each(e.extensions.split(/,/),function(e){if(/^\s*\*\s*$/.test(e))t.push("\\.*");else t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});return new RegExp("("+t.join("|")+")$","i")}(t.mime_types)}return t;case"max_file_size":if(i&&!i.filters)i.filters={};i.filters.max_file_size=t;break;case"multipart":if(!t)i.send_file_name=true;break;case"multipart_params":i.params=i.multipart_params=t;break;case"resize":if(t)return h.extend({preserve_headers:true,crop:false},t);return false;case"prevent_duplicates":if(i&&!i.filters)i.filters={};i.filters.prevent_duplicates=!!t;break;case"unique_names":if(t)i.send_file_name=true;break;case"required_features":return n(h.extend({},i));case"preferred_caps":return n(h.extend({},i,{required_features:true}));case"container":case"browse_button":case"drop_element":return"container"===e?h.get(t):h.getAll(t)}return t}function t(e,t){O[e]=t}function i(e,t){var i,r;i=new E(e);r=h.Runtime.thatCan(i.getOption("required_features"),t||e.runtimes);i.destroy();return r}t("mime_types",function(e,t,i){if(e.length&&!this.getOption("re_ext_filter").test(t.name)){this.trigger("Error",{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:t});i(false)}else i(true)});t("max_file_size",function(e,t,i){var r;e=h.parseSize(e);if(t.size!==r&&e&&t.size>e){this.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:t});i(false)}else i(true)});t("prevent_duplicates",function(e,t,i){var r=this;if(e)this.forEachItem(function(e){if(t.name===e.name&&t.size===e.size){r.trigger("Error",{code:h.FILE_DUPLICATE_ERROR,message:h.translate("Duplicate file error."),file:t});i(false);return}});i(true)});t("prevent_empty",function(e,t,i){if(e&&!t.size&&t.size!==y){this.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:t});i(false)}else i(true)});E.addFileFilter=t;h.inherit(E,g);h.addFileFilter=t;h.predictRuntime=i;return E});i(["plupload","plupload/core/Collection","plupload/core/ArrCollection","plupload/core/Optionable","plupload/core/Queueable","plupload/core/Stats","plupload/core/Queue","plupload/QueueUpload","plupload/QueueResize","plupload/ChunkUploader","plupload/FileUploader","plupload/ImageResizer","plupload/File","plupload/Uploader"])})(this)}.apply(e,arguments),e.plupload}"function"==typeof define&&define.amd?define("plupload",["./moxie"],t):"object"==typeof module&&module.exports?module.exports=t(require("./moxie")):e.plupload=t(e.moxie)}(this||window);